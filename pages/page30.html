<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>30</title>
    <link rel="stylesheet" href="../css/style.css" />
    <style>
      body.ending {
        background: #fff !important;
        color: #111 !important;
        transition: background 0.5s, color 0.5s;
      }
      .ending main.container {
        background: rgba(255,255,255,0.95);
        border-radius: 16px;
        box-shadow: 0 4px 32px rgba(0,0,0,0.08);
        padding: 2em;
      }
      .confetti {
        position: fixed;
        top: 0; left: 0; width: 100vw; height: 100vh;
        pointer-events: none;
        z-index: 9999;
      }
    </style>
  <style>
  @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap');
  </style>
</head>
<body>
    <canvas class="confetti"></canvas>
  <main class="container">
    <h1>Master of the Threshold (Ending)</h1>
    <p class="note">You wake calmly, your breath steady, your mind unusually clear. The dream does not vanish. It lingers, precise and intact, as if stored just behind your eyes. You know now that the boundary is thin—that sleep is not an escape but a door. When night comes, you close your eyes without fear. The familiar landscape unfolds instantly. Silver grass bends in greeting. The sky holds steady. You step forward, returning by choice.</p>
    <p class="note">ENDING 4: Lucid Mastery</p>
    <div style="text-align:center; margin: 24px 0;">
      <button class="btn" onclick="location.href='page31.html'">View Story Tree</button>
    </div>
    <div style="text-align:center; margin: 24px 0;">
      <button class="btn" onclick="window.location.href='page1.html'">Loop Back</button>
    </div>
    <p class="hint" style="text-align:center;"><a href="../index.html">← Back to index</a></p>
  </main>
  <script src="../js/app.js"></script>
<script>
document.body.classList.add('ending');
const canvas = document.querySelector('.confetti');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
const confettiCount = 120;
const confetti = Array.from({length: confettiCount}, () => ({
  x: Math.random() * canvas.width,
  y: Math.random() * canvas.height,
  r: Math.random() * 6 + 4,
  d: Math.random() * confettiCount,
  color: `hsl(${Math.random()*360},90%,60%)`,
  tilt: Math.random() * 10 - 10
}));
function drawConfetti() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  confetti.forEach(c => {
    ctx.beginPath();
    ctx.ellipse(c.x, c.y, c.r, c.r/2, c.tilt, 0, 2 * Math.PI);
    ctx.fillStyle = c.color;
    ctx.fill();
  });
  updateConfetti();
  requestAnimationFrame(drawConfetti);
}
function updateConfetti() {
  confetti.forEach((c, i) => {
    c.y += Math.cos(c.d) + 1 + c.r/4;
    c.x += Math.sin(c.d);
    c.tilt += Math.random() * 0.2 - 0.1;
    if (c.y > canvas.height) {
      confetti[i].y = -10;
      confetti[i].x = Math.random() * canvas.width;
    }
  });
}
drawConfetti();
window.addEventListener('resize', () => {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});
</script>
</body>
</html>
