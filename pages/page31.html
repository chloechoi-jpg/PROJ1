<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Story Tree Diagram</title>
	<link rel="stylesheet" href="../css/style.css">
	<style>
		.tree-container {
			width: 100vw;
			min-height: 100vh;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: flex-start;
			background: #222;
			padding-top: 40px;
		}
		.tree-svg {
			width: 1200px;
			height: 900px;
			background: transparent;
			margin-bottom: 40px;
		}
		.tree-btn {
			position: absolute;
			width: 60px;
			height: 40px;
			background: #764ba2;
			color: #fff;
			border-radius: 8px;
			border: none;
			font-family: 'Roboto Mono', monospace;
			font-size: 1em;
			font-weight: bold;
			cursor: pointer;
			box-shadow: 0 2px 8px rgba(0,0,0,0.2);
			z-index: 2;
			transition: transform 0.2s;
		}
		.tree-btn:hover {
			background: #f093fb;
			color: #222;
			transform: scale(1.1);
			z-index: 3;
		}
		.tree-svg-container {
			position: relative;
			width: 1200px;
			height: 900px;
		}
	</style>
</head>
<body>
	<div class="tree-container">
		<h1 style="color:#fff;">Story Routes Tree Diagram</h1>
		<div class="tree-svg-container">
			<svg class="tree-svg"></svg>
		</div>
	</div>
	<script>
		// Tree structure: page, children
		const tree = [
			{page: 1, children: [2,3,4]},
			{page: 2, children: [5,6,1]},
			{page: 3, children: [7,8,1]},
			{page: 4, children: [9,10,1]},
			{page: 5, children: [11,12]},
			{page: 6, children: [13,5]},
			{page: 7, children: [14,8]},
			{page: 8, children: [15,16]},
			{page: 9, children: [17,18]},
			{page: 10, children: [15,19]},
			{page: 11, children: [20,21]},
			{page: 12, children: [22,11]},
			{page: 13, children: [22,20]},
			{page: 14, children: [20,22]},
			{page: 15, children: [21,23]},
			{page: 16, children: [24,25]},
			{page: 17, children: [20,18]},
			{page: 18, children: [6,7]},
			{page: 19, children: [8,9]},
			{page: 20, children: [10,11]},
			{page: 21, children: [12,13]},
			{page: 22, children: [14,15]},
			{page: 23, children: [16,17]},
			{page: 24, children: [18,19]},
			{page: 25, children: [20,21]},
			{page: 26, children: [22,23]},
			{page: 27, children: [24,25]},
			{page: 28, children: [26,27]},
			{page: 29, children: [28,30]},
			{page: 30, children: [1,2]}
		];
		const endings = [24,26,27,30];
		// Key progression pages
		const mainPath = [1,5,11,20,10,15];
		// Custom layout for main path
		const svg = document.querySelector('.tree-svg');
		const container = document.querySelector('.tree-svg-container');
		// Main path vertical positions
		const mainY = [100, 220, 340, 460, 580, 700];
		const mainX = 600;
		// Place main path nodes
		let nodePos = {};
		mainPath.forEach((page, i) => {
			nodePos[page] = {x: mainX, y: mainY[i]};
		});
		// Place children horizontally
		function placeChildren(parent, level, spread=300) {
			let node = tree.find(t=>t.page===parent);
			if (!node || !node.children) return;
			let y = nodePos[parent].y + 60;
			let n = node.children.length;
			node.children.forEach((child, idx) => {
				if (!nodePos[child]) {
					let x = mainX + (idx - (n-1)/2) * spread;
					nodePos[child] = {x, y};
				}
			});
		}
		mainPath.forEach((page, i) => placeChildren(page, i));
		// Draw lines for main path
		for (let i = 0; i < mainPath.length-1; i++) {
			let from = nodePos[mainPath[i]];
			let to = nodePos[mainPath[i+1]];
			svg.innerHTML += `<line x1="${from.x}" y1="${from.y}" x2="${to.x}" y2="${to.y}" stroke="#f093fb" stroke-width="4" />`;
		}
		// Draw lines for children
		mainPath.forEach(page => {
			let node = tree.find(t=>t.page===page);
			if (!node || !node.children) return;
			node.children.forEach(child => {
				let from = nodePos[page];
				let to = nodePos[child];
				if (from && to) {
					svg.innerHTML += `<line x1="${from.x}" y1="${from.y}" x2="${to.x}" y2="${to.y}" stroke="#bbb" stroke-width="2" />`;
				}
			});
		});
		// Add buttons for main path and children
		Object.entries(nodePos).forEach(([page, pos]) => {
			let btn = document.createElement('button');
			btn.className = 'tree-btn';
			btn.style.left = `${pos.x-30}px`;
			btn.style.top = `${pos.y-20}px`;
			btn.textContent = page;
			btn.onclick = ()=>location.href=`page${page}.html`;
			if (mainPath.includes(Number(page))) btn.style.background = '#f093fb';
			if (endings.includes(Number(page))) btn.style.background = '#f093fb';
			container.appendChild(btn);
		});
	</script>
</body>
</html>
